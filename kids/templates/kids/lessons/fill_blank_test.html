{% extends 'base.html' %}
{% block content %}
<div class="row mb-5">
  <div class="col-12">
    <div class="card shadow-lg border-0 animate__animated animate__fadeInUp" style="background: linear-gradient(135deg, #e0f7fa 60%, #ffe5e5 100%); border-radius:1.5rem;">
      <div class="card-body text-center">
        <h2 class="fw-bold mb-3" style="color:#2d6a4f; font-family:'Comic Sans MS', 'Comic Sans', cursive;">
          <span style="font-size:2rem;">ðŸŽ¬</span> Watch & Learn!
        </h2>
        {% if lesson.video_url %}
        <div class="ratio ratio-16x9 mb-3">
          <video width="100%" controls poster="/static/video_poster.png" style="border-radius:1rem; box-shadow:0 4px 24px rgba(0,0,0,0.10);">
            <source src="{{ lesson.video_url }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
        {% else %}
        <div class="video-caption">No video available for this lesson.</div>
        {% endif %}
        <p class="mt-2" style="font-size:1.15rem; color:#333;">Learn with this video and try the fill-in-the-blank test below!</p>
      </div>
    </div>
  </div>
</div>

<div class="quiz-container">
  <h2 class="quiz-title">Fill in the Blanks Quiz Game <span class="quiz-emoji">ðŸ§ </span></h2>
  <div class="quiz-instructions">Complete each sentence by filling in the missing word. There are 25 unique questions to test your skills!</div>
  <button id="startQuizBtn" class="quiz-btn" onclick="startQuiz()">Start Quiz</button>
  <div class="quiz-progress" style="display:none;">
    <span id="quizProgress">Question 1 of 25</span>
    <span id="quizScore">Score: 0</span>
    <span id="quizTimer">Time: 0s</span>
  </div>
  <div id="quizQuestion" class="quiz-question"></div>
  <input type="text" id="quizAnswer" placeholder="Type the missing word..." autocomplete="off" style="display:none;" />
  <button onclick="submitQuizAnswer()" id="quizSubmitBtn" class="quiz-btn" style="display:none;">Submit</button>
  <div id="quizFeedback" class="quiz-feedback"></div>
  <div id="quizSummary" class="quiz-summary"></div>
</div>

<script>
// 25 unique fill-in-the-blank questions and answers
const quizPatterns = [
  "The ___ jumps over the moon.",
  "A ___ can fly in the sky.",
  "The sun rises in the ___ .",
  "She has a red ___ .",
  "The ___ barks loudly.",
  "I like to eat ___ for breakfast.",
  "The ___ swims in the pond.",
  "He rides his ___ to school.",
  "The ___ is the king of the jungle.",
  "A ___ gives us milk.",
  "The ___ is full of stars.",
  "We read a ___ in class.",
  "The ___ paints a picture.",
  "A ___ can climb trees.",
  "The ___ lays eggs.",
  "She wears a yellow ___ .",
  "The ___ runs very fast.",
  "A ___ has a long trunk.",
  "The ___ makes honey.",
  "He drinks water from a ___ .",
  "The ___ sails on the sea.",
  "A ___ can hop and leap.",
  "The ___ is very wise.",
  "We play with a ___ in the park.",
  "The ___ shines at night.",
  // Extra patterns for variety
  "A ___ is used to write.",
  "The ___ is a fruit that is red.",
  "A ___ is a place where books are kept.",
  "The ___ helps us to see in the dark.",
  "A ___ is a vehicle with two wheels.",
  "The ___ is the largest land animal.",
  "A ___ is a bird that cannot fly.",
  "The ___ is a tool used to cut paper.",
  "A ___ is a shape with three sides.",
  "The ___ is a season after summer.",
  "A ___ is a person who teaches.",
  "The ___ is a color made by mixing red and yellow.",
  "A ___ is a small insect that glows at night.",
  "The ___ is a planet we live on.",
  "A ___ is a place where you can swim.",
  "The ___ is a machine that helps us travel in space.",
  "A ___ is a sweet food made from milk.",
  "The ___ is a bird known for its colorful tail.",
  "A ___ is a tool used to measure length.",
  "The ___ is a flower with thorns.",
  "A ___ is a fruit that is yellow and curved.",
  "The ___ is a building where you learn.",
  "A ___ is a person who draws pictures."
];
const quizAnswers = [
  "cow", "bird", "east", "dress", "dog", "eggs", "fish", "bicycle", "lion", "cow", "sky", "book", "artist", "monkey", "hen", "dress", "cheetah", "elephant", "bee", "glass", "boat", "frog", "owl", "ball", "moon",
  // Extra answers for extra patterns
  "pen", "apple", "library", "torch", "bicycle", "elephant", "penguin", "scissors", "triangle", "autumn", "teacher", "orange", "firefly", "earth", "pool", "rocket", "ice cream", "peacock", "ruler", "rose", "banana", "school", "artist"
];
let quizIdx = 0;
let quizScore = 0;
let quizStartTime = 0;
let quizTimerInterval = null;
function startQuiz() {
  document.getElementById('startQuizBtn').style.display = 'none';
  document.querySelector('.quiz-progress').style.display = 'flex';
  document.getElementById('quizAnswer').style.display = '';
  document.getElementById('quizSubmitBtn').style.display = '';
  quizIdx = 0;
  quizScore = 0;
  showQuizQuestion();
  startQuizTimer();
}
function showQuizQuestion() {
  if (quizIdx >= 25) { // Only show first 25 for the quiz
    endQuiz();
    return;
  }
  document.getElementById('quizQuestion').textContent = quizPatterns[quizIdx];
  document.getElementById('quizAnswer').value = '';
  document.getElementById('quizAnswer').style.display = '';
  document.getElementById('quizSubmitBtn').style.display = '';
  document.getElementById('quizFeedback').textContent = '';
  document.getElementById('quizSummary').textContent = '';
  document.getElementById('quizProgress').textContent = `Question ${quizIdx+1} of 25`;
  document.getElementById('quizScore').textContent = `Score: ${quizScore}`;
}
function submitQuizAnswer() {
  const ans = document.getElementById('quizAnswer').value.trim().toLowerCase();
  const correct = quizAnswers[quizIdx].trim().toLowerCase();
  if (ans === correct) {
    document.getElementById('quizFeedback').textContent = 'âœ… Correct!';
    quizScore++;
    setTimeout(() => {
      quizIdx++;
      showQuizQuestion();
    }, 3000);
  } else {
    document.getElementById('quizFeedback').textContent = `âŒ Wrong! Correct answer is "${quizAnswers[quizIdx]}"`;
    setTimeout(() => {
      quizIdx++;
      showQuizQuestion();
    }, 3000);
  }
  document.getElementById('quizScore').textContent = `Score: ${quizScore}`;
}
function startQuizTimer() {
  quizStartTime = Date.now();
  quizTimerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - quizStartTime)/1000);
    document.getElementById('quizTimer').textContent = `Time: ${elapsed}s`;
  }, 1000);
}
function endQuiz() {
  if (quizTimerInterval) clearInterval(quizTimerInterval);
  document.getElementById('quizQuestion').textContent = 'Quiz Complete!';
  document.getElementById('quizAnswer').style.display = 'none';
  document.getElementById('quizSubmitBtn').style.display = 'none';
  const total = 25;
  const percent = Math.round((quizScore/total)*100);
  const elapsed = Math.floor((Date.now() - quizStartTime)/1000);
  document.getElementById('quizSummary').innerHTML = `<b>Your Score:</b> ${quizScore} / ${total} (${percent}%)<br><b>Time Taken:</b> ${elapsed} seconds`;
  document.getElementById('quizFeedback').textContent = 'Great job!';
}
</script>

<style>
.video-section {
  max-width: 600px;
  margin: 2rem auto;
  background: #f0f8ff;
  border-radius: 1.5rem;
  box-shadow: 0 4px 24px #0077be33;
  padding: 1.5rem;
}
.video-caption { color: #0077be; font-size: 1rem; margin-top: 0.5rem; text-align: center; }
.player-section {
  max-width: 600px;
  margin: 2rem auto;
  background: #e6f7ff;
  border-radius: 1.5rem;
  box-shadow: 0 4px 24px #0077be33;
  padding: 1.5rem;
}
.quiz-container {
  max-width: 600px;
  margin: 2rem auto;
  background: #fffbe6;
  border-radius: 1.5rem;
  box-shadow: 0 4px 24px #ffd60a33;
  padding: 2rem;
}
.quiz-title { color: #ff4066; font-size: 2rem; margin-bottom: 1rem; }
.quiz-instructions { color: #2d6a4f; font-size: 1.1rem; margin-bottom: 1rem; }
.quiz-progress { display: flex; gap: 2rem; font-size: 1.1rem; margin-bottom: 1rem; }
.quiz-question { font-size: 1.3rem; color: #2d6a4f; margin-bottom: 1rem; }
.quiz-feedback { font-size: 1.1rem; margin-top: 0.5rem; color: #ff4066; }
.quiz-summary { font-size: 1.2rem; margin-top: 1.2rem; color: #2d6a4f; }
.quiz-btn { background:#2d6a4f; color:#fff; border:none; border-radius:0.7rem; padding:0.5rem 1.2rem; font-size:1rem; margin-top:0.5rem; cursor:pointer; }
</style>
{% endblock %}
